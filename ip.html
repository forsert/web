<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<script>
    window.onload=function(){
        var t=new sid();
        t.init({
            province:"湖南"
        })
    }
    function sid(){
        this.default={
            id:"silid",
            province:"北京"
        }
    };
    sid.prototype={
        init:function(opt){
            extend(this.default,opt);
            this.id=document.getElementById(this.default.id);
            this.select=this.id.getElementsByTagName("select");
            this.ip();
        },
        ip:function(){
            var This=this;
            var script=document.createElement("script");
            script.src="http://pv.sohu.com/cityjson?ie=utf-8";
            document.body.appendChild(script);
            script.onload = script.onreadystatechange = function() {
                if (!this.readyState || this.readyState === "loaded" || this.readyState === "complete" ) {
                var s=returnCitySN.cname;
                 s=s.substr(0,s.length-1);
                This.default.province=This.default.province || s;
                This.ajax();
                This.chang();
                script.onload = script.onreadystatechange = null;
                }
            }
        },
        ajax:function(){
            var This=this;
            ajax({type:"GET",url:"http://www.huanghanlian.com/data_location/list.json"},function(msg){
                This.order(JSON.parse(msg))
            });
        },
        order:function(msg){
            var This=this;
            var html="";
            var index=null;
            this.msg=msg;
            for(var i=0;i<this.msg.length;i++){
                if(this.default.province==this.msg[i].name){
                    index=i;
                }else{
                    html+="<option name="+i+">"+this.msg[i].name+"</option>";
                };
            };
            this.select[0].innerHTML="<option name="+index+">"+this.msg[index].name+"</option>"
            this.select[0].innerHTML+=html;
            this.pro=this.select[0].options[0].getAttribute("name");
            this.city(this.msg)
            this.qu(this.msg)
        },
        city:function(){
            var cityhtml="";
            for(var i=0;i<this.msg[this.pro].city.length;i++){
                cityhtml+="<option name="+i+">"+this.msg[this.pro].city[i].name+"</option>"
            };
            this.select[1].innerHTML=cityhtml;
        },
        qu:function(){
            var districthtml="";
            for(var i=0;i<this.msg[this.pro].city[0].area.length;i++){
                districthtml+="<option name="+i+">"+this.msg[this.pro].city[0].area[i]+"</option>";
            }
            this.select[2].innerHTML=districthtml;
        }
        ,
        chang:function(){
            var This=this;
            this.select[0].onchange=function(){
                This.pro=this.options[this.options.selectedIndex].getAttribute("name");
                This.city();
                This.qu()
                
            };
            this.select[1].onchange=function(){
                 This.pro=this.options[this.options.selectedIndex].getAttribute("name");
                 This.qu()
            }
        }
    }
    function extend(obj1,obj2){
        for(var attr in obj2){
            obj1[attr]=obj2[attr]
        }
    };
     function ajax(opt,fn){
        var xhr=window.XMLHttpRequest?new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
        xhr.onreadystatechange=function(){
            if(xhr.readyState===4){
                if(xhr.status===200){
                    if(fn){
                        fn(xhr.responseText)
                    }
                }
            }
        };
         xhr.open(opt.type,opt.url,true);
         xhr.send(null);
     }
</script>
<div id="silid">
    <select></select>
    <select></select>
    <select></select>
</div>
</body>
</html>